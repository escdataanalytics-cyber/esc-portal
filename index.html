<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ESC â€¢ Portal Data Analytics</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#0a0a0f;
  --card:#141420;
  --line:rgba(0,212,255,.25);
  --neon:#00d4ff;
  --purple:#8b5cf6;
  --text:#e6f7ff;
  --muted:#9fb8c4;
  --err:#ef4444;
}

*{box-sizing:border-box}

body{
  margin:0;
  min-height:100vh;
  background:radial-gradient(800px 500px at 10% -10%,rgba(0,212,255,.08),transparent),
             radial-gradient(800px 500px at 100% 0%,rgba(139,92,246,.08),transparent),
             var(--bg);
  font-family:Rajdhani;
  color:var(--text);
}

.hidden{display:none}

.container{
  max-width:1100px;
  margin:auto;
  padding:30px;
}

.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:16px;
  padding:24px;
  margin-bottom:20px;
}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:30px;
}

.logo{
  width:56px;
  height:56px;
  border-radius:14px;
  display:grid;
  place-items:center;
  font-family:Orbitron;
  font-weight:900;
  background:linear-gradient(135deg,var(--neon),var(--purple));
  color:#081018;
}

h1,h2{font-family:Orbitron}

input,select{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid var(--line);
  background:#000;
  color:white;
  margin-bottom:12px;
}

button{
  padding:12px 24px;
  border:none;
  border-radius:999px;
  font-weight:800;
  cursor:pointer;
  background:linear-gradient(135deg,var(--neon),var(--purple));
}

.btn-danger{
  background:linear-gradient(135deg,var(--err),#b91c1c);
  color:white;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:20px;
}

.material{
  display:flex;
  justify-content:space-between;
  border:1px solid var(--line);
  padding:12px;
  border-radius:10px;
  margin-bottom:10px;
}
</style>
</head>

<body>

<div class="container">

<!-- LOGIN -->
<div id="loginView">
  <div class="card" style="max-width:420px;margin:auto;">
    <div style="display:flex;gap:15px;align-items:center;justify-content:center;margin-bottom:20px">
      <div class="logo">ESC</div>
      <div>
        <h1>ESC</h1>
        <p style="color:var(--muted)">Data Analytics</p>
      </div>
    </div>

    <input id="email" type="email" placeholder="Email">
    <input id="password" type="password" placeholder="Senha">
    <button id="loginBtn">Entrar</button>
  </div>
</div>

<!-- ADMIN -->
<div id="adminView" class="hidden">
  <div class="header">
    <h1>ðŸ‘‘ Painel Administrador</h1>
    <button class="btn-danger" id="logoutAdmin">Sair</button>
  </div>

  <div class="grid">
    <div class="card">
      <h2>ðŸ“š Cursos</h2>
      <select id="adminCourse"></select>
    </div>

    <div class="card">
      <h2>ðŸ“Œ Aulas</h2>
      <select id="adminLesson"></select>
    </div>

    <div class="card">
      <h2>ðŸ“¤ Upload Material</h2>
      <input id="matTitle" placeholder="TÃ­tulo">
      <input id="file" type="file">
      <button id="uploadBtn">Enviar</button>
    </div>
  </div>
</div>

<!-- USER -->
<div id="userView" class="hidden">
  <div class="header">
    <h1>ðŸ“˜ Portal do Aluno</h1>
    <button class="btn-danger" id="logoutUser">Sair</button>
  </div>

  <div class="grid">
    <div class="card">
      <h2>Cursos</h2>
      <select id="courseSelect"></select>
    </div>

    <div class="card">
      <h2>Aulas</h2>
      <select id="lessonSelect"></select>
    </div>
  </div>

  <div class="card">
    <div id="lessonArea">Selecione uma aula</div>
  </div>

  <div class="card">
    <h2>Materiais</h2>
    <div id="materials"></div>
  </div>
</div>

</div>

<script>
document.addEventListener("DOMContentLoaded", async () => {

  const SUPABASE_URL = "https://eodbbndmclbgjemzjdju.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVvZGJibmRtY2xiZ2plbXpqZGp1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5NDM2MDAsImV4cCI6MjA4NjUxOTYwMH0.ZDZaVXm-K_bX_xgHnH5YSZki-ftD3Sb5A-JT-2zFcPQ";

  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  const loginView = document.getElementById("loginView");
  const adminView = document.getElementById("adminView");
  const userView = document.getElementById("userView");

  const loginBtn = document.getElementById("loginBtn");
  const logoutAdmin = document.getElementById("logoutAdmin");
  const logoutUser = document.getElementById("logoutUser");

  loginBtn.onclick = login;
  logoutAdmin.onclick = logout;
  logoutUser.onclick = logout;

  async function login(){
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    const { data, error } = await supabase.auth.signInWithPassword({ email, password });
    if(error){ alert(error.message); return; }

    routeUser(data.user);
  }

  async function routeUser(user){
    loginView.classList.add("hidden");

    const { data, error } = await supabase
      .from("students")
      .select("is_admin")
      .eq("user_id", user.id)
      .single();

    if(error || !data){
      alert("UsuÃ¡rio nÃ£o vinculado na tabela students");
      return;
    }

    if(data.is_admin){
      adminView.classList.remove("hidden");
      loadCoursesAdmin();
    }else{
      userView.classList.remove("hidden");
      loadCoursesUser();
    }
  }

  async function logout(){
    await supabase.auth.signOut();
    location.reload();
  }

  /* ADMIN */
  async function loadCoursesAdmin(){
    const { data } = await supabase.from("courses").select("*");
    adminCourse.innerHTML = "";
    data.forEach(c=>adminCourse.innerHTML+=`<option value="${c.id}">${c.title}</option>`);
  }

  /* USER */
  async function loadCoursesUser(){
    const { data } = await supabase.from("courses").select("*");
    courseSelect.innerHTML="";
    data.forEach(c=>courseSelect.innerHTML+=`<option value="${c.id}">${c.title}</option>`);
  }

});
</script>

</body>
</html>
